<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>First time you run a Quantum Espresso job? &#8212; OBM Group Cluster  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Quantum Espresso in our cluster" href="q-e_on_our_clusters.html" />
    <link rel="prev" title="Quantum Espresso" href="Q-E.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          OBM Clusters</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/getting_started.html">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/getting_started.html#get-an-account">Get an account</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/getting_started.html#connect-to-our-workstations">Connect to our workstations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/getting_started.html#on-nodes-and-files">On nodes and files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/getting_started.html#run-a-program">Run a program</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/guidelines.html">Guidelines for use of computer equipment at the METU Physics department</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/guidelines.html#definitions">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/guidelines.html#purpose">Purpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/guidelines.html#application">Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/guidelines.html#good-faith">Good Faith</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/guidelines.html#data-safety">Data Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/guidelines.html#respect-for-other-users-privacy">Respect for Other Users Privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/guidelines.html#proper-use">Proper Use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/guidelines.html#awareness-of-the-purposes-for-use-of-resources">Awareness of the Purposes for Use of Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/guidelines.html#rights">Rights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/guidelines.html#liability">Liability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/guidelines.html#surveillance">Surveillance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/guidelines.html#sanctions">Sanctions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/guidelines.html#complaints">Complaints</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../resources/workstations.html">Workstations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../resources/workstations.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../resources/workstations.html#individual-workstation-information">Individual Workstation information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/SBCs.html">Single Board Computers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../resources/SBCs.html#overview">Overview</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Account</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../account/account.html">Getting an account</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../account/account.html#getting-started-on-the-machine-account-quota-password">Getting started on the machine (account, quota, password)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../account/account.html#how-to-get-an-account-and-a-cpu-quota">How to get an account and a CPU quota</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../account/login.html">Logging in for the first time</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../account/login.html#first-time-setup">First-time setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../account/login.html#log-in-with-ssh">Log in with SSH</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../account/login.html#obtain-a-new-password">Obtain a new password</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../account/accounting.html">Quotas</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Jobs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../jobs/dos_and_donts.html">Dos and don’ts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jobs/batch.html">Batch system</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/batch.html#creating-a-job-script">Creating a job script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/batch.html#how-to-pass-command-line-parameters-to-the-job-script">How to pass command-line parameters to the job script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/batch.html#walltime">Walltime</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../jobs/examples.html">Job script examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/examples.html#basic-examples">Basic examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/examples.html#openmp-and-mpi">OpenMP and MPI</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../jobs/slurm_parameter.html">SLURM Workload Manager</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/slurm_parameter.html#slurm-parameter">SLURM Parameter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/slurm_parameter.html#differences-between-cpus-and-tasks">Differences between CPUs and tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/slurm_parameter.html#settings-for-openmp-and-mpi-jobs">Settings for OpenMP and MPI jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/slurm_parameter.html#job-related-environment-variables">Job related environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/slurm_parameter.html#partitions-queues-and-services">Partitions (queues) and services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/slurm_parameter.html#general-job-limitations">General job limitations</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../jobs/interactive.html">Interactive jobs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/interactive.html#starting-an-interacitve-job">Starting an interacitve job</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/interactive.html#keeping-interactive-jobs-alive">Keeping interactive jobs alive</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../jobs/job_management.html">Managing jobs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/job_management.html#job-status-descriptions-in-squeue">Job status descriptions in squeue</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../jobs/monitoring.html">Monitoring your jobs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/monitoring.html#slurm-commands">SLURM commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/monitoring.html#cpu-load-and-memory-consumption-of-your-job">CPU load and memory consumption of your job</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../jobs/running_mpi_jobs.html">Running MPI jobs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/running_mpi_jobs.html#intel-mpi">Intel MPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jobs/running_mpi_jobs.html#openmpi">OpenMPI</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../software/applications.html">Which software is installed on our cluster</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software/applications.html#changes-in-application-software">Changes in application software</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../software/applications.html#missing-or-new-software">Missing or new software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software/applications.html#conda">Conda</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../software/modules.html">Software Module Scheme</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software/modules.html#which-modules-are-currently-loaded">Which modules are currently loaded?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software/modules.html#which-modules-are-available">Which modules are available?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software/modules.html#how-to-load-a-module">How to load a module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software/modules.html#how-to-unload-a-module">How to unload a module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software/modules.html#which-version-of-a-module-is-the-default">Which version of a module is the default?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software/modules.html#how-do-i-switch-to-a-different-version-of-a-module">How do I switch to a different version of a module?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../software/python_r_perl.html">Python, R, Matlab and Perl</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software/python_r_perl.html#python">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software/python_r_perl.html#matlab">MATLAB</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/linux.html">Linux command line</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/linux.html#new-on-linux-systems">New on Linux systems?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../help/AboutLicenses.html">General comments about licenses</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../sw_guides.html">Application guides</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="Q-E.html">Quantum Espresso</a></li>
<li class="toctree-l2"><a class="reference internal" href="../VASP/VASP.html">VASP (Vienna Ab initio Simulation Package)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../LAMMPS/LAMMPS.html">Large-scale Atomic/Molecular Massively Parallel Simulator (LAMMPS)</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Storage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../storage/storage.html">Storage and backup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../storage/storage.html#available-file-system">Available file system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/storage.html#home-area">Home area</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/storage.html#nas-area">NAS area</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/storage.html#work-scratch-areas">Work/scratch areas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/storage.html#closing-of-user-account">Closing of user account</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/storage.html#privacy-of-user-data">Privacy of user data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/storage.html#management-of-many-small-files-10000">Management of many small files (&gt; 10000)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/storage.html#compression-of-data">Compression of data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/storage.html#binary-data-and-endianness">Binary data and endianness</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../storage/file_transfer.html">Transferring files to/from our group cluster</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../storage/file_transfer.html#carbon-head-node-and-home-directories">Carbon (Head node and home directories)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/file_transfer.html#mistake-not-nas-server">Mistake Not… (NAS server)</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../development/compilers.html">Compilers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/compilers.html#usage-of-the-intel-ifort-compiler">Usage of the Intel ifort compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/compilers.html#usage-of-the-intel-c-c-compilers">Usage of the Intel C/C++ compilers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/compilers.html#usage-of-the-nvidia-pgi-compilers">Usage of the NVIDIA (PGI) compilers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/environment.html">Environment modules</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="first-time-you-run-a-quantum-espresso-job">
<span id="first-time-q-e"></span><h1>First time you run a Quantum Espresso job?<a class="headerlink" href="#first-time-you-run-a-quantum-espresso-job" title="Permalink to this headline">¶</a></h1>
<p>This page contains info aimed at first time
users of Quantum Espresso on in one of our workstations, but may also be useful to
more experienced users. Please look carefully through the
provided examples. Also note that the job-script example is rather richly
commented to provide additional and relevant info.</p>
<p>If you want to run this testjob, download the copies of the scripts and put them
into your test job folder (which I assume you have created in advance).</p>
<section id="quantum-espresso-tutorial">
<h2>Quantum Espresso Tutorial<a class="headerlink" href="#quantum-espresso-tutorial" title="Permalink to this headline">¶</a></h2>
<p>Let’s do the basics of <code class="docutils literal notranslate"><span class="pre">pw.x</span></code> in the
<a class="reference external" href="http://www.fisica.uniud.it/~giannozz/QE-Tutorial/handson_pwscf.pdf">Q-E tutorial</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is better you do the tutorial in your own PC, since they are very “light”
calculations, and you will not need to wait for resources. You can easily install
Quantum Espresso to your own pc using <a class="reference external" href="https://anaconda.org/conda-forge/qe">Anaconda</a>
by</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">qe</span></code></p>
</div>
<p>Download the tarred job <a class="reference download internal" download="" href="../../_downloads/949afb96456655651e8853f7f15e8e38/handson_pwscf.tar.gz"><code class="xref download docutils literal notranslate"><span class="pre">handson_pwscf.tar.gz</span></code></a>.</p>
<p>move this file to your test job folder and type</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tar -zxf handson_pwscf.tar.gz
</pre></div>
</div>
<p>The instructions you need to follow are in <cite>handson_pwscf.pdf</cite>. These examples
are designed to be run interactively. If you want to do this in our cluster,
you need to reserve yourself an interactive job <a class="reference internal" href="../../jobs/interactive.html#interactive"><span class="std std-ref">Interactive jobs</span></a></p>
</section>
<section id="quantum-espresso-production-test-job">
<h2>Quantum Espresso Production Test Job<a class="headerlink" href="#quantum-espresso-production-test-job" title="Permalink to this headline">¶</a></h2>
<p>In this example, we will run one of the basic Quantum Espresso examples</p>
<p>Download the tarred job <a class="reference download internal" download="" href="../../_downloads/4bcafcef845ca349cddc91f4b6d9b93e/qe-example-job.tar.gz"><code class="xref download docutils literal notranslate"><span class="pre">qe-example-job.tar.gz</span></code></a>.</p>
<p>This is a simple <code class="docutils literal notranslate"><span class="pre">pw.x</span></code> run for the Silicon. It should run very fast and minimal resources</p>
<p>Upload this to your home directory, and untar the file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tar -zxf qe-example-job.tar.gz
<span class="nb">cd</span> qe-example-job
</pre></div>
</div>
<p>Please inspect the <code class="docutils literal notranslate"><span class="pre">pw.x</span></code> input file to see the structure. The pseudopotential
is already included in this example in the <cite>pseudo</cite> directory. However, you are
encouraged to check out the <a class="reference external" href="https://www.materialscloud.org/discover/sssp/table/efficiency">Standart Solid State PPs</a>
In Carbon, <cite>pslibrary</cite> pseudo potentials can be reached from <cite>/share/apps/pslibrary1.0.0</cite></p>
<p>Next, you need to create a job script in this directory. You can use the example
script here <a class="reference download internal" download="" href="../../_downloads/8b2705548da7e28b947de677c102de76/job_q-e.sh"><code class="xref download docutils literal notranslate"><span class="pre">job_q-e.sh</span></code></a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch job_q-e.sh
</pre></div>
</div>
<p>This script will ask for shared 4 cpus in <a class="reference internal" href="../../resources/Triumphant-Coal.html#about-triumphant-coal"><span class="std std-ref">Triumphant Coal</span></a>. Copy the files
in the example directory to the local scratch (which is much much faster), and finaly
copy the results back to where it was launched in a <cite>.tar.gz</cite> archive.</p>
<p>Feel free to modify the job script for your needs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>################### Quantum Espresso Job Batch Script Example ###################
# Section for defining queue-system variables:
#-------------------------------------
# This script asks for Triumphant Coal and 4 cores .
# Runtime for this job is 59 minutes; syntax is hh:mm:ss.
#-------------------------------------
# SLURM-section
## Select Triumphant Coal workstation
#SBATCH --partition=triumphant-coal
## 4 jobs
#SBATCH --ntasks=4
##Name of the job
#SBATCH --job-name=q-e_ex
##one hour
#SBATCH --time=00:59:00
##Ask/Allow sharing the node
#SBATCH --oversubscribe
## asks SLURM to send the USR1 signal 10 minutes before the end of the time limit
#SBATCH --signal=B:USR1@600
##The name of the log file (you can see the progress of your job here)
#SBATCH --output=q-e_ex.log

###########################################################
# This section is for defining job variables and settings
# that needs to be defined before running the job
###########################################################

#name of the input file
input_file=&quot;in.qe-example-pw&quot;
#name of the output file
output_file=&quot;out.qe-example-pw&quot;
#name of the executable
qe_executable=&quot;pw.x&quot;

# We load all the default program system settings with module load:

module --quiet purge
module load compiler/latest mkl/latest mpi/latest triumphant-coal/Q-E/oneapi/git280822-oneapi21.2
# You may check other available versions with &quot;module avail q-e&quot;


#Don&#39;t forget to set this to 1, if you do not setup your run for OMP parallelization!
export OMP_NUM_THREADS=1

# A unique file tag for the created files
file_tag=$( date +&quot;%d%m%y-%H%M&quot; )

# Define and create a unique local scratch directory for this job. Remember, this will
# make your job run  much faster!
SCRATCH_DIRECTORY=/scratch/${USER}/${SLURM_JOBID}.$file_tag
mkdir -p ${SCRATCH_DIRECTORY}
cd ${SCRATCH_DIRECTORY}

# You can copy everything you need to the scratch directory
# ${SLURM_SUBMIT_DIR} points to the path where this script was submitted from
rsync -arp ${SLURM_SUBMIT_DIR}/ .


#############################################################################
# This section is about collecting the results from the local scratch back to
# where the job was run. Make sure that you have enough quota, if you want to
# collect the wave functions as well!
#############################################################################


# define the handler function
# note that this is not executed here, but rather
# when the associated signal is sent
cleanup_function()
{
        cd ${SCRATCH_DIRECTORY}
        echo &quot;function cleanup_function called at $(date)&quot;
        tar cvf results-${SLURM_JOBID}-$file_tag.tar *
        gzip  results-${SLURM_JOBID}-$file_tag.tar
        du -sh results-${SLURM_JOBID}-$file_tag.tar.gz
        mv results-${SLURM_JOBID}-$file_tag.tar.gz ${SLURM_SUBMIT_DIR}
}

# call cleanup_function once we receive USR1 signal
trap &#39;cleanup_function&#39; USR1

###############################################################################
# This section actually runs the job. It needs to be after the previous two
# sections
#################################################################################

echo &quot;starting calculation at $(date)&quot;

# First, let&#39;s go to the local scratch directory
cd ${SCRATCH_DIRECTORY}

# Running the program:
# the &quot;&amp;&quot; after the compute step and &quot;wait&quot; are important for the cleanup process
# the &quot;tee&quot; is used to mirror the output to the slurm output, so that you can follow
# the job progress more easily
run_line=&quot;mpirun ${qe_executable} &lt; ${input_file} |tee ${output_file} &amp;&quot;
echo $run_line
eval $run_line
wait

echo &quot;Job finished at&quot;
date
cleanup_function
################### Job Ended ###################
exit 0
</pre></div>
</div>
<p>See <a class="reference internal" href="q-e_on_our_clusters.html#q-e-on-our-cluster"><span class="std std-ref">Quantum Espresso in our cluster</span></a> for further details, tips and tricks.</p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../../_sources/applications/Q-E/firsttime_q-e.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2021, obm.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>